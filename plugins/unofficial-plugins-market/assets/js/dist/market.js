!function(){"use strict";function t(t,r,e){$("input#plugin-"+t).attr({disabled:!0}),$("input#plugin-"+t).val(trans("market.downloading")),toastr.info(trans("market.readyToDownload",{"plugin-name":r})),$.ajax({type:"POST",url:"/admin/plugins-market/download",data:{name:t,version:e},success:function(e){if(void 0===e.code||null===e.code)toastr.error(trans("market.error.unknown",{msg:e?"("+e+"})":""}));else switch(e.code){case-1:toastr.error(trans("market.failedDownload",{message:trans("market.error.requestPermission")}));break;case 0:toastr.success(trans("market.completeDownload",{"plugin-name":r})),$("input#plugin-"+t).hasClass("btn-success")&&$("input#plugin-"+t).removeClass("btn-success").addClass("btn-primary"),$("input#plugin-"+t).hasClass("btn-warning")&&$("input#plugin-"+t).removeClass("btn-warning").addClass("btn-primary");break;case 1:toastr.error(trans("market.failedDownload",{message:trans("market.error.writePermission")}));break;case 2:toastr.error(trans("market.failedDownload",{message:trans("market.error.connection")}));break;case 3:toastr.error(trans("market.failedDownload",{message:trans("market.error.download")}));break;case 4:toastr.error(trans("market.failedDownload",{message:trans("market.error.unzip")}));break;default:toastr.error(trans("market.error.unknown",{msg:e.msg?"("+e.msg+"})":""}))}$("input#plugin-"+t).attr({disabled:!1}),$("input#plugin-"+t).val(trans("market.download"))},error:function(){toastr.error(trans("market.error.unknown")),$("input#plugin-"+t).attr("disabled",!1)}})}$(document).ready(function(){$(".box-body").css("min-height",$(".content-wrapper").height()-$(".content-header").outerHeight()-120),$("#market-table").DataTable({language:trans("vendor.datatables"),scrollX:!0,autoWidth:!1,processing:!0,ordering:!1,serverSide:!1,ajax:{url:"/admin/plugins-market/data",dataSrc:""},columnDefs:[{targets:0,title:trans("market.market.title"),data:"title"},{targets:1,title:trans("market.market.description"),data:"description",width:"40%"},{targets:2,title:trans("market.market.author"),data:"author",width:"10%"},{targets:3,title:trans("market.market.version"),data:"version",width:"9%",render:function(t,r,e){for(var a="",n=t.length-1;n>=0;n--)a+="<option>"+t[n]+"</option>";return'\n            <select id="plugin-'+e.name+'-vers" class="form-control">\n              '+a+"\n            </select>"}},{targets:4,title:trans("market.market.operations"),data:"brief",width:"20%",render:function(t,r,e){var a="btn-primary",n="";switch(e.versionStatus){case"preview":a="btn-warning",n=trans("market.market.versionPre");break;case"new":a="btn-success",n=trans("market.market.versionNew")}return'<input\n              type="button"\n              id="plugin-'+e.name+'"\n              class="btn '+a+' btn-sm"\n              title="'+n+'" onclick="readyToDownload(\''+e.name+"','"+e.title+"','"+e.versionStatus+'\');" value="'+trans("market.market.download")+'">'+('<a class="btn btn-default btn-sm"\n            href="'+t+'"\n            target="_blank"\n            title="'+trans("market.market.briefHint")+'">\n              '+trans("market.market.viewBrief")+"\n            </a>")}}]})}),window.readyToDownload=function(r,e,a){var n=$("select#plugin-"+r+"-vers").val();if("preview"!==a)return t(r,e,n);swal({title:trans("market.preview.title"),text:trans("market.preview.text"),type:"warning",showCancelButton:!0,confirmButtonText:trans("market.preview.confirmButton"),cancelButtonText:trans("market.preview.cancelButton")}).then(function(){return t(r,e,n)})}}();
